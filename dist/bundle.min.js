!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).exprEval={})}(this,function(t){"use strict";var x="INUMBER",w="IOP1",d="IOP2",g="IOP3",E="IVAR",m="IVARNAME",A="IFUNCALL",M="IFUNDEF",b="IEXPR",k="IEXPREVAL",O="IMEMBER",T="IENDSTATEMENT",C="IARRAY",S="IOBJECT";function y(t,e){this.type=t,this.value=null!=e?e:0}function u(t){return new y(w,t)}function c(t){return new y(d,t)}function L(t){return new y(g,t)}function N(t,i,o){var e,r,s,n,a,p=[];if(I(t))return P(t,o);for(var h=t.length,u=0;u<h;u++){var c=t[u],f=c.type;if(f===x||f===m)p.push(c.value);else if(f===d)r=p.pop(),e=p.pop(),"and"===c.value?p.push(!!e&&!!N(r,i,o)):"or"===c.value?p.push(!!e||!!N(r,i,o)):"="===c.value?(s=i.binaryOps[c.value],p.push(s(e,N(r,i,o),o))):(s=i.binaryOps[c.value],p.push(s(P(e,o),P(r,o))));else if(f===g)l=p.pop(),r=p.pop(),e=p.pop(),"?"===c.value?p.push(N(e?r:l,i,o)):(s=i.ternaryOps[c.value],p.push(s(P(e,o),P(r,o),P(l,o))));else if(f===E){if(/^__proto__|prototype|constructor$/.test(c.value))throw new Error("prototype access detected");if(c.value in i.functions)p.push(i.functions[c.value]);else if(c.value in i.unaryOps&&i.parser.isOperatorEnabled(c.value))p.push(i.unaryOps[c.value]);else{var l=o[c.value];if(void 0===l)throw new Error("undefined variable: "+c.value);p.push(l)}}else if(f===w)e=p.pop(),s=i.unaryOps[c.value],p.push(s(P(e,o)));else if(f===A){for(a=c.value,n=[];0<a--;)n.unshift(P(p.pop(),o));if(!(s=p.pop()).apply||!s.call)throw new Error(s+" is not a function");p.push(s.apply(void 0,n))}else if(f===M)p.push(function(){for(var s=p.pop(),n=[],t=c.value;0<t--;)n.unshift(p.pop());function e(){for(var t=Object.assign({},o),e=0,r=n.length;e<r;e++)t[n[e]]=arguments[e];return N(s,i,t)}var r=p.pop();return Object.defineProperty(e,"name",{value:r,writable:!1}),o[r]=e}());else if(f===b)p.push(function(e,r){return I(e)?e:{type:k,value:function(t){return N(e.value,r,t)}}}(c,i));else if(f===k)p.push(c);else if(f===O)e=p.pop(),p.push(e[c.value]);else if(f===T)p.pop();else if(f===C){for(a=c.value,n=[];0<a--;)n.unshift(p.pop());p.push(n)}else{if(f!==S)throw new Error("invalid Expression");for(a=c.value,n=[];0<a--;){var v=p.pop(),y=p.pop();n.unshift([y,v])}p.push(Object.fromEntries(n))}}if(1<p.length)throw new Error("invalid Expression (parity)");return 0===p[0]?0:P(p[0],o)}function I(t){return t&&t.type===k}function P(t,e){return I(t)?t.value(e):t}function F(t,e){for(var r,s,n,i,o,a,p=[],h=0;h<t.length;h++){var u=t[h],c=u.type;if(c===x)"number"==typeof u.value&&u.value<0?p.push("("+u.value+")"):Array.isArray(u.value)?p.push("["+u.value.map(B).join(", ")+"]"):p.push(B(u.value));else if(c===d)s=p.pop(),r=p.pop(),i=u.value,e?"^"===i?p.push("Math.pow("+r+", "+s+")"):"and"===i?p.push("(!!"+r+" && !!"+s+")"):"or"===i?p.push("(!!"+r+" || !!"+s+")"):"||"===i?p.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+r+"),("+s+")))"):"=="===i?p.push("("+r+" === "+s+")"):"!="===i?p.push("("+r+" !== "+s+")"):"["===i?p.push(r+"[("+s+") | 0]"):p.push("("+r+" "+i+" "+s+")"):"["===i?p.push(r+"["+s+"]"):p.push("("+r+" "+i+" "+s+")");else if(c===g){if(n=p.pop(),s=p.pop(),r=p.pop(),"?"!==(i=u.value))throw new Error("invalid Expression");p.push("("+r+" ? "+s+" : "+n+")")}else if(c===E||c===m)p.push(u.value);else if(c===w)r=p.pop(),"-"===(i=u.value)||"+"===i?p.push("("+i+r+")"):e?"not"===i?p.push("(!"+r+")"):"!"===i?p.push("fac("+r+")"):p.push(i+"("+r+")"):"!"===i?p.push("("+r+"!)"):p.push("("+i+" "+r+")");else if(c===A){for(a=u.value,o=[];0<a--;)o.unshift(p.pop());i=p.pop(),p.push(i+"("+o.join(", ")+")")}else if(c===M){for(s=p.pop(),a=u.value,o=[];0<a--;)o.unshift(p.pop());r=p.pop(),e?p.push("("+r+" = function("+o.join(", ")+") { return "+s+" })"):p.push("("+r+"("+o.join(", ")+") = "+s+")")}else if(c===O)r=p.pop(),p.push(r+"."+u.value);else if(c===C){for(a=u.value,o=[];0<a--;)o.unshift(p.pop());p.push("["+o.join(", ")+"]")}else if(c===S){for(a=u.value,o=[];0<a--;){var f=p.pop(),l=String(p.pop()),v=l.charAt(0);'"'===v||"0"<=v&&v<="9"?o.unshift(l+": "+f):o.unshift("["+l+"]: "+f)}p.push("{"+o.join(", ")+"}")}else if(c===b)p.push("("+F(u.value,e)+")");else if(c!==T)throw new Error("invalid Expression")}return 1<p.length&&(p=e?[p.join(",")]:[p.join(";")]),String(p[0])}function B(t){return"string"==typeof t?JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):t}function a(t,e){for(var r=0;r<t.length;r++)if(t[r]===e)return!0;return!1}function p(t,e,r){for(var s=!!(r=r||{}).withMembers,n=null,i=0;i<t.length;i++){var o=t[i];o.type===E||o.type===m?s||a(e,o.value)?n=(null!==n&&(a(e,n)||e.push(n)),o.value):e.push(o.value):o.type===O&&s&&null!==n?n+="."+o.value:o.type===b?p(o.value,e,r):null!==n&&(a(e,n)||e.push(n),n=null)}null===n||a(e,n)||e.push(n)}function r(t,e){this.tokens=t,this.parser=e,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.functions=e.functions}y.prototype.toString=function(){switch(this.type){case x:case w:case d:case g:case E:case m:case T:return this.value;case A:return"CALL "+this.value;case M:return"DEF "+this.value;case C:return"ARRAY "+this.value;case S:return"OBJECT "+this.value;case O:return"."+this.value;default:return"Invalid Instruction"}},r.prototype.simplify=function(t){return new r(function t(e,r,s,n,i){for(var o,a,p,h,u=[],c=[],f=0;f<e.length;f++){var l=e[f],v=l.type;if(v===x||v===m)Array.isArray(l.value)?u.push.apply(u,t(l.value.map(function(t){return new y(x,t)}).concat(new y(C,l.value.length)),r,s,n,i)):u.push(l);else if(v===E&&i.hasOwnProperty(l.value))l=new y(x,i[l.value]),u.push(l);else if(v===d&&1<u.length)a=u.pop(),o=u.pop(),h=s[l.value],l=new y(x,h(o.value,a.value)),u.push(l);else if(v===g&&2<u.length)p=u.pop(),a=u.pop(),o=u.pop(),"?"===l.value?u.push((o.value?a:p).value):(h=n[l.value],l=new y(x,h(o.value,a.value,p.value)),u.push(l));else if(v===w&&0<u.length)o=u.pop(),h=r[l.value],l=new y(x,h(o.value)),u.push(l);else if(v===b){for(;0<u.length;)c.push(u.shift());c.push(new y(b,t(l.value,r,s,n,i)))}else if(v===O&&0<u.length)o=u.pop(),u.push(new y(x,o.value[l.value]));else{for(;0<u.length;)c.push(u.shift());c.push(l)}}for(;0<u.length;)c.push(u.shift());return c}(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,t=t||{}),this.parser)},r.prototype.substitute=function(t,e){return e instanceof r||(e=this.parser.parse(String(e))),new r(function t(e,r,s){for(var n=[],i=0;i<e.length;i++){var o=e[i],a=o.type;if(a===E&&o.value===r)for(var p=0;p<s.tokens.length;p++){var h=(h=s.tokens[p]).type===w?u(h.value):h.type===d?c(h.value):h.type===g?L(h.value):new y(h.type,h.value);n.push(h)}else n.push(a===b?new y(b,t(o.value,r,s)):o)}return n}(this.tokens,t,e),this.parser)},r.prototype.evaluate=function(t){return N(this.tokens,this,t=t||{})},r.prototype.toString=function(){return F(this.tokens,!1)},r.prototype.symbols=function(t){var e=[];return p(this.tokens,e,t=t||{}),e},r.prototype.variables=function(t){var e=[],r=(p(this.tokens,e,t=t||{}),this.functions);return e.filter(function(t){return!(t in r)})},r.prototype.toJSFunction=function(t,e){var r=this,s=new Function(t,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+F(this.simplify(e).tokens,!0)+"; }");return function(){return s.apply(r,arguments)}};var s="TEOF",h="TOP",f="TNUMBER",U="TSTRING",n="TPAREN",i="TBRACKET",o="TBRACE",l="TCOMMA",v="TNAME",_="TSEMICOLON";function q(t,e,r){this.type=t,this.value=e,this.index=r}function j(t,e){this.pos=0,this.current=null,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.consts=t.consts,this.expression=e,this.savedPosition=0,this.savedCurrent=null,this.options=t.options,this.parser=t}q.prototype.toString=function(){return this.type+": "+this.value},j.prototype.newToken=function(t,e,r){return new q(t,e,null!=r?r:this.pos)},j.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current},j.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent},j.prototype.next=function(){return this.pos>=this.expression.length?this.newToken(s,"EOF"):this.isWhitespace()||this.isComment()?this.next():this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isBrace()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName()?this.current:void this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')},j.prototype.isString=function(){var t=!1,e=this.pos,r=this.expression.charAt(e);if("'"===r||'"'===r)for(var s=this.expression.indexOf(r,e+1);0<=s&&this.pos<this.expression.length;){if(this.pos=s+1,"\\"!==this.expression.charAt(s-1)){var n=this.expression.substring(e+1,s);this.current=this.newToken(U,this.unescape(n),e),t=!0;break}s=this.expression.indexOf(r,s+1)}return t},j.prototype.isParen=function(){var t=this.expression.charAt(this.pos);return("("===t||")"===t)&&(this.current=this.newToken(n,t),this.pos++,!0)},j.prototype.isBracket=function(){var t=this.expression.charAt(this.pos);return!("["!==t&&"]"!==t||!this.isOperatorEnabled("[")||(this.current=this.newToken(i,t),this.pos++,0))},j.prototype.isBrace=function(){var t=this.expression.charAt(this.pos);return!("{"!==t&&"}"!==t||!this.isOperatorEnabled("{")||(this.current=this.newToken(o,t),this.pos++,0))},j.prototype.isComma=function(){return","===this.expression.charAt(this.pos)&&(this.current=this.newToken(l,","),this.pos++,!0)},j.prototype.isSemicolon=function(){return";"===this.expression.charAt(this.pos)&&(this.current=this.newToken(_,";"),this.pos++,!0)},j.prototype.isConst=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||"_"!==r&&"."!==r&&(r<"0"||"9"<r)))break}if(t<e){t=this.expression.substring(t,e);if(t in this.consts)return this.current=this.newToken(f,this.consts[t]),this.pos+=t.length,!0}return!1},j.prototype.isNamedOp=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||"_"!==r&&(r<"0"||"9"<r)))break}if(t<e){t=this.expression.substring(t,e);if(this.isOperatorEnabled(t)&&(t in this.binaryOps||t in this.unaryOps||t in this.ternaryOps))return this.current=this.newToken(h,t),this.pos+=t.length,!0}return!1},j.prototype.isName=function(){for(var t=this.pos,e=t,r=!1;e<this.expression.length;e++){var s=this.expression.charAt(e);if(s.toUpperCase()===s.toLowerCase())if(e!==this.pos||"$"!==s&&"_"!==s){if(e===this.pos||!r||"_"!==s&&(s<"0"||"9"<s))break}else"_"===s&&(r=!0);else r=!0}return!!r&&(t=this.expression.substring(t,e),this.current=this.newToken(v,t),this.pos+=t.length,!0)},j.prototype.isWhitespace=function(){for(var t=!1,e=this.expression.charAt(this.pos);!(" "!==e&&"\t"!==e&&"\n"!==e&&"\r"!==e||(t=!0,this.pos++,this.pos>=this.expression.length));)e=this.expression.charAt(this.pos);return t};var V=/^[0-9a-f]{4}$/i;function R(t,e,r){this.parser=t,this.tokens=e,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=!1!==r.allowMemberAccess}j.prototype.unescape=function(t){var e=t.indexOf("\\");if(e<0)return t;for(var r=t.substring(0,e);0<=e;){var s=t.charAt(++e);switch(s){case"'":r+="'";break;case'"':r+='"';break;case"\\":r+="\\";break;case"/":r+="/";break;case"b":r+="\b";break;case"f":r+="\f";break;case"n":r+="\n";break;case"r":r+="\r";break;case"t":r+="\t";break;case"u":var n=t.substring(e+1,e+5);V.test(n)||this.parseError("Illegal escape sequence: \\u"+n),r+=String.fromCharCode(parseInt(n,16)),e+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+s+'"')}++e;var i=t.indexOf("\\",e);r+=t.substring(e,i<0?t.length:i),e=i}return r},j.prototype.isComment=function(){return"/"===this.expression.charAt(this.pos)&&"*"===this.expression.charAt(this.pos+1)&&(this.pos=this.expression.indexOf("*/",this.pos)+2,1===this.pos&&(this.pos=this.expression.length),!0)},j.prototype.isRadixInteger=function(){var t,e,r=this.pos;if(r>=this.expression.length-2||"0"!==this.expression.charAt(r))return!1;if("x"===this.expression.charAt(++r))t=16,e=/^[0-9a-f]$/i;else{if("b"!==this.expression.charAt(r))return!1;t=2,e=/^[01]$/i}for(var s=!1,n=++r;r<this.expression.length;){var i=this.expression.charAt(r);if(!e.test(i))break;r++,s=!0}return s&&(this.current=this.newToken(f,parseInt(this.expression.substring(n,r),t)),this.pos=r),s},j.prototype.isNumber=function(){for(var t,e=!1,r=this.pos,s=r,n=r,i=!1,o=!1,a=!1,p=this.parser.options.allowCommaInNumbers;r<this.expression.length&&("0"<=(t=this.expression.charAt(r))&&t<="9"||!i&&"."===t||p&&!i&&","===t);){if("."===t)i=!0;else if(","===t){var h=this.expression.charAt(r+1);if(h<"0"||"9"<h)break;i=o=!0}else a=!0;r++,e=a}if(e&&(n=r),"e"===t||"E"===t){r++;for(var u=!0,c=!1;r<this.expression.length;){if(t=this.expression.charAt(r),!u||"+"!==t&&"-"!==t){if(!("0"<=t&&t<="9"))break;u=!(c=!0)}else u=!1;r++}c||(r=n)}return e?(s=this.expression.substring(s,r),o&&(s=s.replace(",",".")),this.current=this.newToken(f,parseFloat(s)),this.pos=r):this.pos=n,e},j.prototype.isOperator=function(){var t=this.pos,e=this.expression.charAt(this.pos);if("+"===e||"-"===e||"*"===e||"/"===e||"%"===e||"^"===e||"?"===e||":"===e||"."===e)this.current=this.newToken(h,e);else if("∙"===e||"•"===e)this.current=this.newToken(h,"*");else if(">"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(h,">="),this.pos++):this.current=this.newToken(h,">");else if("<"===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(h,"<="),this.pos++):this.current=this.newToken(h,"<");else if("|"===e){if("|"!==this.expression.charAt(this.pos+1))return!1;this.current=this.newToken(h,"||"),this.pos++}else if("="===e)"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(h,"=="),this.pos++):this.current=this.newToken(h,e);else{if("!"!==e)return!1;"="===this.expression.charAt(this.pos+1)?(this.current=this.newToken(h,"!="),this.pos++):this.current=this.newToken(h,e)}return this.pos++,!!this.isOperatorEnabled(this.current.value)||(this.pos=t,!1)},j.prototype.isOperatorEnabled=function(t){return this.parser.isOperatorEnabled(t)},j.prototype.getCoordinates=function(){for(var t,e=0,r=-1;e++,t=this.pos-r,0<=(r=this.expression.indexOf("\n",r+1))&&r<this.pos;);return{line:e,column:t}},j.prototype.parseError=function(t){var e=this.getCoordinates();throw new Error("parse error ["+e.line+":"+e.column+"]: "+t)},R.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()},R.prototype.tokenMatches=function(t,e){return void 0===e||(Array.isArray(e)?a(e,t.value):"function"==typeof e?e(t):t.value===e)},R.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()},R.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken},R.prototype.accept=function(t,e){return!(this.nextToken.type!==t||!this.tokenMatches(this.nextToken,e)||(this.next(),0))},R.prototype.expect=function(t,e){var r;if(!this.accept(t,e))throw r=this.tokens.getCoordinates(),new Error("parse error ["+r.line+":"+r.column+"]: Expected "+(e||t))},R.prototype.parseAtom=function(t){var e,r=this.tokens.unaryOps;if(this.accept(v)||this.accept(h,function(t){return t.value in r}))t.push(new y(E,this.current.value));else if(this.accept(f))t.push(new y(x,this.current.value));else if(this.accept(U))t.push(new y(x,this.current.value));else if(this.accept(n,"("))this.parseExpression(t),this.expect(n,")");else if(this.accept(i,"["))this.accept(i,"]")?t.push(new y(C,0)):(e=this.parseArrayList(t),t.push(new y(C,e)));else{if(!this.accept(o,"{"))throw e=this.tokens.getCoordinates(),new Error("parse error ["+e.line+":"+e.column+"]: Unexpected "+this.nextToken);this.accept(o,"}")?t.push(new y(S,0)):(e=this.parseObjectEntries(t),t.push(new y(S,e)))}},R.prototype.parseExpression=function(t){var e=[];this.parseUntilEndStatement(t,e)||(this.parseVariableAssignmentExpression(e),this.parseUntilEndStatement(t,e))||this.pushExpression(t,e)},R.prototype.pushExpression=function(t,e){for(var r=0,s=e.length;r<s;r++)t.push(e[r])},R.prototype.parseUntilEndStatement=function(t,e){return!!this.accept(_)&&(!this.nextToken||this.nextToken.type===s||this.nextToken.type===n&&")"===this.nextToken.value||e.push(new y(T)),this.nextToken.type!==s&&this.parseExpression(e),t.push(new y(b,e)),!0)},R.prototype.parseArrayList=function(t){for(var e=0;!this.accept(i,"]");)for(this.parseExpression(t),++e;this.accept(l);)this.parseExpression(t),++e;return e},R.prototype.parseObjectEntries=function(t){for(var e=0;!this.accept(o,"}");)if(this.accept(U)||this.accept(f)||this.accept(v)?t.push(new y(x,this.current.value)):(this.expect(i,"["),this.parseExpression(t),this.expect(i,"]")),++e,this.expect(h,":"),this.parseExpression(t),!this.accept(l)){this.expect(o,"}");break}return e},R.prototype.parseVariableAssignmentExpression=function(t){for(this.parseConditionalExpression(t);this.accept(h,"=");){var e=t.pop(),r=[],s=t.length-1;if(e.type===A){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var n=0,i=e.value+1;n<i;n++){var o=s-n;t[o].type===E&&(t[o]=new y(m,t[o].value))}this.parseVariableAssignmentExpression(r),t.push(new y(b,r)),t.push(new y(M,e.value))}else{if(e.type!==E&&e.type!==O)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(r),t.push(new y(m,e.value)),t.push(new y(b,r)),t.push(c("="))}}},R.prototype.parseConditionalExpression=function(t){for(this.parseOrExpression(t);this.accept(h,"?");){var e=[],r=[];this.parseConditionalExpression(e),this.expect(h,":"),this.parseConditionalExpression(r),t.push(new y(b,e)),t.push(new y(b,r)),t.push(L("?"))}},R.prototype.parseOrExpression=function(t){for(this.parseAndExpression(t);this.accept(h,"or");){var e=[];this.parseAndExpression(e),t.push(new y(b,e)),t.push(c("or"))}},R.prototype.parseAndExpression=function(t){for(this.parseComparison(t);this.accept(h,"and");){var e=[];this.parseComparison(e),t.push(new y(b,e)),t.push(c("and"))}};var $=["==","!=","<","<=",">=",">","in"],J=(R.prototype.parseComparison=function(t){for(this.parseAddSub(t);this.accept(h,$);){var e=this.current;this.parseAddSub(t),t.push(c(e.value))}},["+","-","||"]),D=(R.prototype.parseAddSub=function(t){for(this.parseTerm(t);this.accept(h,J);){var e=this.current;this.parseTerm(t),t.push(c(e.value))}},["*","/","%"]);function G(t,e){return Number(t)+Number(e)}function W(t,e){return t-e}function X(t,e){return t*e}function Y(t,e){return t/e}function K(t,e){return t%e}function z(t,e){return Array.isArray(t)&&Array.isArray(e)?t.concat(e):""+t+e}function H(t,e){return t===e}function Q(t,e){return t!==e}function Z(t,e){return e<t}function tt(t,e){return t<e}function et(t,e){return e<=t}function rt(t,e){return t<=e}function st(t,e){return Boolean(t&&e)}function nt(t,e){return Boolean(t||e)}function it(t,e){return!!e&&(Array.isArray(e)?a(e,t):"object"==typeof e?t in e:String(e).includes(t))}function ot(t){return(Math.exp(t)-Math.exp(-t))/2}function at(t){return(Math.exp(t)+Math.exp(-t))/2}function pt(t){return t===1/0?1:t===-1/0?-1:(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function ht(t){return t===-1/0?t:Math.log(t+Math.sqrt(t*t+1))}function ut(t){return Math.log(t+Math.sqrt(t*t-1))}function ct(t){return Math.log((1+t)/(1-t))/2}function ft(t){return Math.log(t)*Math.LOG10E}function lt(t){return-t}function vt(t){return!t}function yt(t){return t<0?Math.ceil(t):Math.floor(t)}function xt(t){return Math.random()*(t||1)}function wt(t){return Et(t+1)}R.prototype.parseTerm=function(t){for(this.parseFactor(t);this.accept(h,D);){var e=this.current;this.parseFactor(t),t.push(c(e.value))}},R.prototype.parseFactor=function(t){var e=this.tokens.unaryOps;if(this.save(),this.accept(h,function(t){return t.value in e})){if("-"!==this.current.value&&"+"!==this.current.value){if(this.nextToken.type===n&&"("===this.nextToken.value)return this.restore(),void this.parseExponential(t);if(this.nextToken.type===_||this.nextToken.type===l||this.nextToken.type===s||this.nextToken.type===n&&")"===this.nextToken.value)return this.restore(),void this.parseAtom(t)}var r=this.current;this.parseFactor(t),t.push(u(r.value))}else this.parseExponential(t)},R.prototype.parseExponential=function(t){for(this.parsePostfixExpression(t);this.accept(h,"^");)this.parseFactor(t),t.push(c("^"))},R.prototype.parsePostfixExpression=function(t){for(this.parseFunctionCall(t);this.accept(h,"!");)t.push(u("!"))},R.prototype.parseFunctionCall=function(t){var e,r=this.tokens.unaryOps;if(this.accept(h,function(t){return t.value in r})){var s=this.current;this.parseAtom(t),t.push(u(s.value))}else for(this.parseMemberExpression(t);this.accept(n,"(");)this.accept(n,")")?t.push(new y(A,0)):(e=this.parseArgumentList(t),t.push(new y(A,e)))},R.prototype.parseArgumentList=function(t){for(var e=0;!this.accept(n,")");)for(this.parseExpression(t),++e;this.accept(l);)this.parseExpression(t),++e;return e},R.prototype.parseMemberExpression=function(t){for(this.parseAtom(t);this.accept(h,".")||this.accept(i,"[");){var e=this.current;if("."===e.value){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(v),t.push(new y(O,this.current.value))}else{if("["!==e.value)throw new Error("unexpected symbol: "+e.value);if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(t),this.expect(i,"]"),t.push(c("["))}}};var dt=4.7421875,gt=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function Et(t){var e,r,s,n;if(e=t,isFinite(e)&&e===Math.round(e)){if(t<=0)return isFinite(t)?1/0:NaN;if(171<t)return 1/0;for(var i=t-2,o=t-1;1<i;)o*=i,i--;return o=0===o?1:o}if(t<.5)return Math.PI/(Math.sin(Math.PI*t)*Et(1-t));if(171.35<=t)return 1/0;if(85<t)return n=(s=(r=(e=t*t)*t)*t)*t,Math.sqrt(2*Math.PI/t)*Math.pow(t/Math.E,t)*(1+1/(12*t)+1/(288*e)-139/(51840*r)-571/(2488320*s)+163879/(209018880*n)+5246819/(75246796800*n*t));--t;for(var a=gt[0],p=1;p<gt.length;++p)a+=gt[p]/(t+p);return e=t+dt+.5,Math.sqrt(2*Math.PI)*Math.pow(e,t+.5)*Math.exp(-e)*a}function mt(t){return(Array.isArray(t)?t:String(t)).length}function At(){for(var t=0,e=0,r=0;r<arguments.length;r++){var s,n=Math.abs(arguments[r]);e<n?(t=t*(s=e/n)*s+1,e=n):t+=0<n?(s=n/e)*s:n}return e===1/0?1/0:e*Math.sqrt(t)}function Mt(t,e,r){return t?e:r}function bt(t,e){return void 0===e||0==+e?Math.round(t):(t=+t,e=-+e,isNaN(t)||"number"!=typeof e||e%1!=0?NaN:(t=t.toString().split("e"),+((t=(t=Math.round(+(t[0]+"e"+(t[1]?+t[1]-e:-e)))).toString().split("e"))[0]+"e"+(t[1]?+t[1]+e:e))))}function kt(t,e,r){return r&&(r[t]=e),e}function Ot(t,e){if(Array.isArray(t))return t[0|e]}function Tt(t,e){return Array.isArray(t)?Ot(t,e):t?t[e]:void 0}function Ct(t){return 1===arguments.length&&Array.isArray(t)?Math.max.apply(Math,t):Math.max.apply(Math,arguments)}function St(t){return 1===arguments.length&&Array.isArray(t)?Math.min.apply(Math,t):Math.min.apply(Math,arguments)}function Nt(r,t){if("function"!=typeof r)throw new Error("First argument to map is not a function");if(Array.isArray(t))return t.map(function(t,e){return r(t,e)});throw new Error("Second argument to map is not an array")}function It(s,t,e){if("function"!=typeof s)throw new Error("First argument to fold is not a function");if(Array.isArray(e))return e.reduce(function(t,e,r){return s(t,e,r)},t);throw new Error("Second argument to fold is not an array")}function Pt(r,t){if("function"!=typeof r)throw new Error("First argument to filter is not a function");if(Array.isArray(t))return t.filter(function(t,e){return r(t,e)});throw new Error("Second argument to filter is not an array")}function Ft(t,e){if(Array.isArray(e)||"string"==typeof e)return e.indexOf(t);throw new Error("Second argument to indexOf is not a string or array")}function jt(t,e){if(Array.isArray(e))return e.join(t);throw new Error("Second argument to join is not an array")}function Rt(t){return(0<t)-(t<0)||+t}var Lt=1/3;function Bt(t){return t<0?-Math.pow(-t,Lt):Math.pow(t,Lt)}function Ut(t){return Math.exp(t)-1}function _t(t){return Math.log(1+t)}function qt(t){return Math.log(t)/Math.LN2}function Vt(t){if(Array.isArray(t))return t.reduce(function(t,e){return t+Number(e)},0);throw new Error("Sum argument is not an array")}function e(t){this.options=t||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||ot,cosh:Math.cosh||at,tanh:Math.tanh||pt,asinh:Math.asinh||ht,acosh:Math.acosh||ut,atanh:Math.atanh||ct,sqrt:Math.sqrt,cbrt:Math.cbrt||Bt,log:Math.log,log2:Math.log2||qt,ln:Math.log,lg:Math.log10||ft,log10:Math.log10||ft,expm1:Math.expm1||Ut,log1p:Math.log1p||_t,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||yt,"-":lt,"+":Number,exp:Math.exp,not:vt,length:mt,"!":wt,sign:Math.sign||Rt},this.binaryOps={"+":G,"-":W,"*":X,"/":Y,"%":K,"^":Math.pow,"||":z,"==":H,"!=":Q,">":Z,"<":tt,">=":et,"<=":rt,and:st,or:nt,in:it,"=":kt,"[":!1===this.options.allowMemberAccess?Ot:Tt},this.ternaryOps={"?":Mt},this.functions={random:xt,fac:wt,min:St,max:Ct,hypot:Math.hypot||At,pyt:Math.hypot||At,pow:Math.pow,atan2:Math.atan2,if:Mt,gamma:Et,roundTo:bt,map:Nt,fold:It,filter:Pt,indexOf:Ft,join:jt,sum:Vt},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}e.prototype.parse=function(t){var e=[],t=new R(this,new j(this,t),{allowMemberAccess:this.options.allowMemberAccess});return t.parseExpression(e),t.expect(s,"EOF"),new r(e,this)},e.prototype.evaluate=function(t,e){return this.parse(t).evaluate(e)};var $t=new e,Jt=(e.parse=function(t){return $t.parse(t)},e.evaluate=function(t,e){return $t.parse(t).evaluate(e)},{"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","{":"object","()=":"fndef"});e.prototype.isOperatorEnabled=function(t){var t=Jt.hasOwnProperty(t=t)?Jt[t]:t,e=this.options.operators||{};return!(t in e&&!e[t])};var Dt={Parser:e,Expression:r};t.Expression=r,t.Parser=e,t.default=Dt,Object.defineProperty(t,"__esModule",{value:!0})});
